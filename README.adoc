= Generate JWT policy

ifdef::env-github[]
image:https://img.shields.io/static/v1?label=Available%20at&message=Gravitee.io&color=1EC9D2["Gravitee.io", link="https://download.gravitee.io/#graviteeio-apim/plugins/policies/gravitee-policy-generate-jwt/"]
image:https://img.shields.io/badge/License-Apache%202.0-blue.svg["License", link="https://github.com/gravitee-io/gravitee-policy-generate-jwt/blob/master/LICENSE.txt"]
image:https://img.shields.io/badge/semantic--release-conventional%20commits-e10079?logo=semantic-release["Releases", link="https://github.com/gravitee-io/gravitee-policy-generate-jwt/releases"]
image:https://circleci.com/gh/gravitee-io/gravitee-policy-generate-jwt.svg?style=svg["CircleCI", link="https://circleci.com/gh/gravitee-io/gravitee-policy-generate-jwt"]
image:https://f.hubspotusercontent40.net/hubfs/7600448/gravitee-github-button.jpg["Join the community forum", link="https://community.gravitee.io?utm_source=readme", height=20]
endif::[]

== Phase

[cols="4*", options="header"]
|===
^|onRequest
^|onResponse
^|onRequestContent
^|onResponseContent

^.^| X
^.^| -
^.^| -
^.^| -

|===

== Description

You use the `generate-JWT` policy to generate a signed JWT with a configurable set of claims. This JWT can subsequently be forwarded
to backend targets, or used in some other way.

When a signed JWT is generated, it is put in the `jwt.generated` attribute of the request execution context.

== Configuration

|===
|Property |Required |Description |Type |Default

.^|signature
^.^|X
|Signature used to sign the token
^.^|Algorithm
^.^|RS256

.^|kid
^.^|-
|key ID (`kid`) to include in the JWT header
^.^|string
^.^|-

.^|id
^.^|-
|JWT ID (`jti`) claim is a unique identifier for the JWT
^.^|string
^.^|UUID

.^|audiences
^.^|-
|JWT audience claim; can be a string or an array of strings
^.^|List of string
^.^|-

.^|issuer
^.^|-
|Claim that identifies the issuer of the JWT
^.^|string
^.^|-

.^|subject
^.^|-
|Claim that identifies or makes a statement about the subject of the JWT
^.^|string
^.^|-

|===

== Attributes

|===
|Name |Description

.^|jwt.generated
|JWT generated by the policy

|===

You can read the token using Expression Language:

[source]
----
{#context.attributes['jwt.generated']}
----

== Examples

[source, json]
----
{
    "name": "Generate JWT (External)",
    "description": "",
    "enabled": true,
    "policy": "policy-ext-generate-jwt",
    "configuration": {
        "signature": "RSA_RS256",
        "subject": "ba8f7aac-7f43-4458-924b-45ce5c932f01",
        "kid": "not-used-key-id",
        "groups": [
            "Access Group 1"
        ],
        "issuer": "marin-yakimov",
        "content": "-----BEGIN PRIVATE KEY-----\n <<<< edited for security reasons >>>> -----END PRIVATE KEY-----",
        "keyResolver": "INLINE",
        "expiresIn": 8,
        "x509CertificateChain": "NONE",
        "expiresInUnit": "HOURS",
        "x5t": "ZeVsoR17hoMd09dsU6tDsrBCCXw",
        "audiences": [
            "cb6fc017-9a79-4b95-978b-71795176636"
        ],
        "customClaims": [
            {
                "name": "name",
                "value": "Marin Yakimov"
            },
            {
                "name": "oid",
                "value": "marin.yakimov@documaster.com"
            }
        ]
    }
}
----

== Errors

=== HTTP status code

|===
|Code |Message

| ```500```
| Unexpected error while creating and signing the token

|===
